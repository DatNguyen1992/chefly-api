{"version":3,"file":"history.service.js","sourceRoot":"","sources":["../../src/history/history.service.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;AAAA,2CAA+D;AAC/D,4EAAsE;AACtE,6DAAmD;AACnD,uCAA+C;AAC/C,+CAA+C;AAC/C,wEAA+E;AAE/E,mDAA6C;AAItC,IAAM,cAAc,GAApB,MAAM,cAAe,SAAQ,gCAAuB;IACzD,YAA+C,YAA4B;QACzE,KAAK,CAAC,YAAY,CAAC,CAAC;QADyB,iBAAY,GAAZ,YAAY,CAAgB;IAE3E,CAAC;IAED,KAAK,CAAC,eAAe,CACnB,IAAY,EACZ,KAAsB;QAEtB,MAAM,UAAU,GAAG,IAAI,2BAAU,EAAW,CAAC;QAC7C,IAAI,KAAK,EAAE,KAAK,EAAE,CAAC;YACjB,UAAU,CAAC,KAAK,GAAG,KAAK,EAAE,KAAK,CAAC;QAClC,CAAC;QACD,IAAI,KAAK,EAAE,IAAI,EAAE,CAAC;YAChB,UAAU,CAAC,IAAI,GAAG,KAAK,EAAE,IAAI,CAAC;QAChC,CAAC;QAED,UAAU,CAAC,SAAS,GAAG;YACrB,IAAI;YACJ,GAAG,CAAC,KAAK,EAAE,IAAI,IAAI;gBACjB,IAAI,EAAE,KAAK,EAAE,IAAI;aAClB,CAAC;YACF,GAAG,CAAC,KAAK,EAAE,MAAM,IAAI;gBACnB,IAAI,EAAE,EAAE,MAAM,EAAE,KAAK,EAAE,MAAM,EAAE,QAAQ,EAAE,GAAG,EAAE;aAC/C,CAAC;SACH,CAAC;QAEF,IAAI,KAAK,EAAE,IAAI,EAAE,CAAC;YAChB,UAAU,CAAC,IAAI,GAAG;gBAChB,SAAS,EAAE,KAAK,EAAE,IAAI,KAAK,oBAAQ,CAAC,GAAG,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,MAAM;aACzD,CAAC;QACJ,CAAC;QAED,OAAO,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;IACnC,CAAC;IAED,KAAK,CAAC,aAAa,CACjB,IAAY,EACZ,gBAAkC;QAElC,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC;YAC7C,IAAI;YACJ,GAAG,gBAAgB;SACpB,CAAC,CAAC;QAEH,IAAI,CAAC,OAAO,EAAE,CAAC;YACb,MAAM,IAAI,0BAAiB,CAAC,mBAAmB,CAAC,CAAC;QACnD,CAAC;QACD,OAAO,OAAO,CAAC;IACjB,CAAC;IAED,KAAK,CAAC,MAAM,CAAC,EAAU,EAAE,IAAY;QACnC,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC;YAChD,GAAG,EAAE,EAAE;YACP,IAAI;SACL,CAAC,CAAC;QAEH,OAAO,OAAO,CAAC;IACjB,CAAC;IAED,KAAK,CAAC,SAAS,CAAC,IAAY;QAC1B,MAAM,IAAI,CAAC,YAAY,CAAC,UAAU,CAAC;YACjC,IAAI;SACL,CAAC,CAAC;IACL,CAAC;CACF,CAAA;AAjEY,wCAAc;yBAAd,cAAc;IAD1B,IAAA,mBAAU,GAAE;IAEE,WAAA,IAAA,sBAAW,EAAC,wBAAO,CAAC,IAAI,CAAC,CAAA;qCAAuB,gBAAK;GADvD,cAAc,CAiE1B","sourcesContent":["import { Injectable, NotFoundException } from '@nestjs/common';\nimport { BaseRepository } from '@shared/repositories/base.repository';\nimport { History } from './schemas/history.schema';\nimport { DeleteResult, Model } from 'mongoose';\nimport { InjectModel } from '@nestjs/mongoose';\nimport { DataFilter, PaginationData } from '@shared/interfaces/data.interface';\nimport { QueryHistoryDto } from './dto/query-history.dto';\nimport { SortType } from '@common/constants';\nimport { CreateHistoryDto } from './dto/create-history.dto';\n\n@Injectable()\nexport class HistoryService extends BaseRepository<History> {\n  constructor(@InjectModel(History.name) private historyModel: Model<History>) {\n    super(historyModel);\n  }\n\n  async findHistoryPage(\n    user: string,\n    query: QueryHistoryDto,\n  ): Promise<PaginationData<History>> {\n    const dataFilter = new DataFilter<History>();\n    if (query?.limit) {\n      dataFilter.limit = query?.limit;\n    }\n    if (query?.page) {\n      dataFilter.page = query?.page;\n    }\n\n    dataFilter.condition = {\n      user,\n      ...(query?.type && {\n        type: query?.type,\n      }),\n      ...(query?.search && {\n        name: { $regex: query?.search, $options: 'i' },\n      }),\n    };\n\n    if (query?.sort) {\n      dataFilter.sort = {\n        createdAt: query?.sort === SortType.ASC ? 'asc' : 'desc',\n      };\n    }\n\n    return this.findPage(dataFilter);\n  }\n\n  async createHistory(\n    user: string,\n    createHistoryDto: CreateHistoryDto,\n  ): Promise<History> {\n    const history = await this.historyModel.create({\n      user,\n      ...createHistoryDto,\n    });\n\n    if (!history) {\n      throw new NotFoundException('History not found');\n    }\n    return history;\n  }\n\n  async remove(id: string, user: string): Promise<DeleteResult> {\n    const history = await this.historyModel.deleteOne({\n      _id: id,\n      user,\n    });\n\n    return history;\n  }\n\n  async removeAll(user: string): Promise<void> {\n    await this.historyModel.deleteMany({\n      user,\n    });\n  }\n}\n"]}